import re

def clean_annotation(match):
    annotation = match.group(1)
    # Initialize a dictionary to store the extracted values
    values = {}
    # Search and extract each value
    for key in ["q1", "q2", "q3", "pp1"]:
        result = re.search(rf"{key}=([0-9\.]+);?", annotation)
        values[key] = round(float(result.group(1)), 3)

    # Format the string to return the modified annotation
    return f"'[q1={values['q1']};q2={values['q2']};q3={values['q3']};pp1={values['pp1']}]'"

# input tree data (changable)
tree_data = "(CALSQU:NaN,(GALGAL:NaN,(ALELAT:NaN,(CHATOR:NaN,((PHORUB:NaN,(PODCRI:NaN,PODPOD:NaN)'[q1=0.9992739499452551;q2=9.965392908264028E-5;q3=6.263961256623104E-4;f1=36767.28571428572;f2=3.6666666666666665;f3=23.047619047619047;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=36794.0]':6.78570412724462)'[q1=0.9609107463173231;q2=0.01972668177995753;q3=0.019362571902707782;f1=35355.749999999585;f2=725.8235294117574;f3=712.4264705882301;pp1=1.0;pp2=0.0;pp3=0.0;QC=136;EN=36794.0]':2.8357747136963285,(((((ACACHL:NaN,(((CNELOR:NaN,PROCAF:NaN)'[q1=0.9976652508043495;q2=0.0013369156979528235;q3=9.978334976976058E-4;f1=36708.09523809524;f2=49.19047619047619;f3=36.71428571428571;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=36794.0]':5.642839308959344,MENNOV:NaN)'[q1=0.9951140131543186;q2=0.0023271457302821113;q3=0.002558841115399251;f1=36614.225;f2=85.625;f3=94.15000000000003;pp1=1.0;pp2=0.0;pp3=0.0;QC=40;EN=36794.0]':4.910398973191517,SERLUN:NaN)'[q1=0.8043926879763961;q2=0.11124668495721561;q3=0.0843606270663886;f1=29596.82456140352;f2=4093.2105263157914;f3=3103.964912280702;pp1=1.0;pp2=0.0;pp3=0.0;QC=57;EN=36794.0]':1.226069275668503)'[q1=0.9991419947696786;q2=4.3296612370374393E-4;q3=4.250391066176249E-4;f1=36762.430555555555;f2=15.930555555555554;f3=15.63888888888889;pp1=1.0;pp2=0.0;pp3=0.0;QC=72;EN=36794.0]':6.624277575388226,CHUBUR:NaN)'[q1=0.381841029068058;q2=0.29691925473783526;q3=0.32123971619415037;f1=14049.458823530125;f2=10924.84705882391;f3=11819.694117647568;pp1=1.0;pp2=0.0;pp3=1.3283814343280825E-84;QC=85;EN=36794.0]':0.07552772432551064,UROIND:NaN)'[q1=0.5787528008793583;q2=0.2103005169924967;q3=0.21094668212812034;f1=21294.630555555108;f2=7737.797222221923;f3=7761.57222222206;pp1=1.0;pp2=0.0;pp3=0.0;QC=360;EN=36794.0]':0.4590329995037722,(((PHALEP:NaN,CICMAG:NaN)'[q1=0.35755959175538604;q2=0.32425964895933124;q3=0.31818075928529177;f1=13156.047619047675;f2=11930.809523809634;f3=11707.142857143026;pp1=1.0;pp2=1.379941687513945E-22;pp3=8.584716566588305E-23;QC=21;EN=36794.0]':0.03700098224101389,NYCLEU:NaN)'[q1=0.33384554976067793;q2=0.3338523443467539;q3=0.3323021058925453;f1=12283.513157894384;f2=12283.763157894464;f3=12226.72368421031;pp1=0.3815076613684144;pp2=0.3824361946212647;pp3=0.23605614401718816;QC=76;EN=36794.0]':7.549998976744933E-4,(OPIHOA:NaN,PSOCRE:NaN)'[q1=0.346497665046459;q2=0.3204345864934147;q3=0.33306774846013054;f1=12749.035087719412;f2=11790.070175438701;f3=12254.894736842043;pp1=0.9999996591307507;pp2=4.694474971265306E-8;pp3=2.9392449954974624E-7;QC=57;EN=36794.0]':0.01992965491027033)'[q1=0.3340717862039251;q2=0.32777476874679473;q3=0.33815344504926914;f1=12291.837301587218;f2=12060.144841269566;f3=12442.017857142808;pp1=0.0867620070640621;pp2=0.020514667742771244;pp3=0.8927233251914454;QC=504;EN=36794.0]':0.00109465931994504)'[q1=0.3547064128689976;q2=0.3254000818678212;q3=0.3198935052631643;f1=13051.067755101898;f2=11972.770612244614;f3=11770.161632652867;pp1=1.0;pp2=6.233200719624656E-18;pp3=3.8616676938747E-18;QC=1225;EN=36794.0]':0.032569844856796246,((MESUNI:NaN,COLPIC:NaN)'[q1=0.3491311035647517;q2=0.3319596349137809;q3=0.31890926152147353;f1=12845.929824561474;f2=12214.122807017655;f3=11733.947368421097;pp1=0.9999999995027753;pp2=4.156793049865311E-10;pp3=8.154552330689948E-11;QC=57;EN=36794.0]':0.023967358739632117,(TAUERY:NaN,(LOPRUF:NaN,CROSUL:NaN)'[q1=0.3396827122434558;q2=0.3296759047153145;q3=0.3306413830412332;f1=12498.285714285714;f2=12130.095238095282;f3=12165.619047619133;pp1=0.9838705380277972;pp2=0.0073180634364152135;pp3=0.008811398535536972;QC=21;EN=36794.0]':0.009555731645869599)'[q1=0.3730481657478425;q2=0.3215001444743492;q3=0.30545168977778636;f1=13725.934210526117;f2=11829.276315789206;f3=11238.789473683872;pp1=1.0;pp2=1.632264032170615E-57;pp3=0.0;QC=76;EN=36794.0]':0.06140428150917738)'[q1=0.34219784152178123;q2=0.3450494645866128;q3=0.31275269389160276;f1=12590.827380952418;f2=12695.74999999983;f3=11507.422619047631;pp1=0.007969382179954557;pp2=0.9920306178200454;pp3=0.0;QC=504;EN=36794.0]':0.013371817696075738)'[q1=0.3532354686452554;q2=0.3290101647007623;q3=0.3177543666539858;f1=12996.945833333528;f2=12105.599999999848;f3=11691.454166666754;pp1=0.9999999999999981;pp2=1.4293520225486168E-15;pp3=4.757347328649283E-16;QC=720;EN=36794.0]':0.030293038638401475)'[q1=0.9996646227841212;q2=9.645647681260904E-5;q3=2.3892073906622312E-4;f1=36781.660130718956;f2=3.549019607843137;f3=8.790849673202613;pp1=1.0;pp2=0.0;pp3=0.0;QC=153;EN=36794.0]':7.516894895835089)'[q1=0.9934309941838344;q2=0.0031961732891232263;q3=0.0033728325270424527;f1=36552.3;f2=117.6;f3=124.10000000000001;pp1=1.0;pp2=0.0;pp3=0.0;QC=40;EN=36794.0]':4.615826024519984)'[q1=0.9998369299342285;q2=8.282923975699971E-5;q3=8.024082601459348E-5;f1=36788.0;f2=3.0476190476190474;f3=2.9523809523809526;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=36794.0]':8.161741988197084));"
cleaned_tree = re.sub(r"'\[(.*?)\]'", clean_annotation, tree_data)

print(cleaned_tree)
