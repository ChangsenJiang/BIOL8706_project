import re

# 定义一个函数，用于处理和修改每个匹配的注释
def clean_annotation(match):
    # 获取整个注释字符串
    annotation = match.group(1)
    # 提取需要保留的值
    q1 = round(float(re.search(r"q1=([0-9\.]+);", annotation).group(1)), 3)
    q2 = round(float(re.search(r"q2=([0-9\.]+);", annotation).group(1)), 3)
    q3 = round(float(re.search(r"q3=([0-9\.]+);", annotation).group(1)), 3)
    pp1 = round(float(re.search(r"pp1=([0-9\.]+);", annotation).group(1)), 3)
    
    # 返回修改后的注释
    return f"'[q1={q1};q2={q2};q3={q3};pp1={pp1}]'"

# 读取原始树数据
tree_data = """(CALSQU:0.0,(GALGAL:6.95792,(ALELAT:0.0,(CHATOR:3.458,((PHORUB:0.0,(PODCRI:0.0,PODPOD:0.0)'[q1=0.8704269486878176;q2=0.05966090313916402;q3=0.06991214817301768;f1=3703.666666666664;f2=253.85714285714292;f3=297.4761904761902;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=4255.0]':1.6364681941548578)'[q1=0.6507482546485132;q2=0.16659984792977006;q3=0.18265189742171795;f1=2768.9338235294235;f2=708.8823529411716;f3=777.1838235294099;pp1=1.0;pp2=0.0;pp3=0.0;QC=136;EN=4255.0]':0.6460594741007175,(((((ACACHL:0.0,(((CNELOR:0.0,PROCAF:6.26448)'[q1=0.8419338593251623;q2=0.08784063566672252;q3=0.0702255050081136;f1=3582.4285714285656;f2=373.76190476190436;f3=298.80952380952334;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=4255.0]':1.4380258769010625,MENNOV:5.65363)'[q1=0.7542949471210334;q2=0.10618683901292615;q3=0.13951821386603996;f1=3209.524999999997;f2=451.8250000000008;f3=593.6500000000001;pp1=1.0;pp2=0.0;pp3=0.0;QC=40;EN=4255.0]':0.9974372704669328,SERLUN:15.96874)'[q1=0.5608963654730241;q2=0.2367575813800068;q3=0.20234605314696857;f1=2386.6140350877176;f2=1007.403508771929;f3=860.9824561403512;pp1=1.0;pp2=0.0;pp3=0.0;QC=57;EN=4255.0]':0.41725462799643903)'[q1=0.8784338686512587;q2=0.062393915654785054;q3=0.05917221569395469;f1=3737.736111111106;f2=265.4861111111104;f3=251.77777777777723;pp1=1.0;pp2=0.0;pp3=0.0;QC=72;EN=4255.0]':1.7001353723638735,CHUBUR:7.93974)'[q1=0.29736642012856507;q2=0.29237851662403874;q3=0.4102550632473883;f1=1265.2941176470445;f2=1244.0705882352847;f3=1745.6352941176372;pp1=1.167527172652334E-25;pp2=1.0332747817937935E-25;pp3=1.0;QC=85;EN=4255.0]':0.0,UROIND:8.45592)'[q1=0.42188993341167075;q2=0.2841552421987214;q3=0.2939548243896072;f1=1795.141666666659;f2=1209.0805555555596;f3=1250.7777777777785;pp1=1.0;pp2=2.0934321513772507E-33;pp3=2.5874021149048033E-33;QC=360;EN=4255.0]':0.14235443885477245,(((PHALEP:0.3378,CICMAG:0.93849)'[q1=0.3635610766045518;q2=0.3359632924850286;q3=0.30047563091041074;f1=1546.9523809523678;f2=1429.5238095237967;f3=1278.5238095237978;pp1=0.9998636504689752;pp2=1.2152249498528971E-4;pp3=1.4827036039620724E-5;QC=21;EN=4255.0]':0.04626750289204101,NYCLEU:7.317)'[q1=0.33389820025975697;q2=0.3217453151091593;q3=0.34435648463108387;f1=1420.7368421052659;f2=1369.0263157894728;f3=1465.2368421052618;pp1=0.14341116759674138;pp2=0.052884347087237486;pp3=0.8037044853160212;QC=76;EN=4255.0]':7.298864051778343E-4,(OPIHOA:0.0,PSOCRE:6.7751)'[q1=0.32497577669201816;q2=0.3509761477724841;q3=0.32404807553548637;f1=1382.7719298245372;f2=1493.4035087719199;f3=1378.8245614034945;pp1=0.012276458023158776;pp2=0.9761881802104293;pp3=0.011535361766327398;QC=57;EN=4255.0]':0.0)'[q1=0.3560316527707841;q2=0.326370469848731;q3=0.3175978773804861;f1=1514.9146825396863;f2=1388.7063492063505;f3=1351.3789682539684;pp1=0.996818059605578;pp2=0.0020008377739039094;pp3=0.0011811026205036266;QC=504;EN=4255.0]':0.03451070069570756)'[q1=0.3242976570181545;q2=0.32673263147797327;q3=0.34896971150387296;f1=1379.8865306122473;f2=1390.2473469387762;f3=1484.8661224489795;pp1=0.02172104804560594;pp2=0.025800784158796816;pp3=0.9524781677955974;QC=1225;EN=4255.0]':0.0,((MESUNI:0.36918,COLPIC:7.38278)'[q1=0.3365411177768102;q2=0.33233966231677675;q3=0.3311192199064015;f1=1431.9824561403273;f2=1414.105263157885;f3=1408.9122807017382;pp1=0.46654965443839336;pp2=0.2830009245867072;pp3=0.2504494209750666;QC=57;EN=4255.0]':0.004704111904581919,(TAUERY:6.75878,(LOPRUF:7.64267,CROSUL:11.33882)'[q1=0.3394773655643191;q2=0.3257903866599486;q3=0.33473224777572186;f1=1444.4761904761779;f2=1386.2380952380813;f3=1424.2857142856965;pp1=0.5772601871643528;pp2=0.1280621097570257;pp3=0.29467770307773383;QC=21;EN=4255.0]':0.00913802659738328)'[q1=0.3342414496876725;q2=0.3386140144721375;q3=0.3271445358401881;f1=1422.1973684210466;f2=1440.8026315789452;f3=1392.0000000000005;pp1=0.3014545296710531;pp2=0.5449783519761605;pp3=0.15356711835278644;QC=76;EN=4255.0]':0.0012451481440012345)'[q1=0.34252373491503835;q2=0.33293650793650786;q3=0.3245397571484537;f1=1457.4384920634882;f2=1416.644841269841;f3=1380.9166666666704;pp1=0.7384088655689129;pp2=0.1756707050193266;pp3=0.08592042941176034;QC=504;EN=4255.0]':0.013759105928843395)'[q1=0.33732765374069595;q2=0.33710960960960995;q3=0.3255627366496934;f1=1435.3291666666612;f2=1434.4013888888903;f3=1385.2694444444453;pp1=0.4398740973503646;pp2=0.4264526103146417;pp3=0.13367329233588998;QC=720;EN=4255.0]':0.005889903110348748)'[q1=0.8641797808038221;q2=0.05882045728593067;q3=0.076999761910248;f1=3677.084967320263;f2=250.281045751635;f3=327.63398692810523;pp1=1.0;pp2=0.0;pp3=0.0;QC=153;EN=4255.0]':1.5894642045031564)'[q1=0.7548472385428909;q2=0.13103995299647483;q3=0.11411280846063464;f1=3211.875000000001;f2=557.5750000000004;f3=485.5500000000004;pp1=1.0;pp2=0.0;pp3=0.0;QC=40;EN=4255.0]':0.9996854298372464)'[q1=0.9156510547814897;q2=0.04454143584578365;q3=0.03980750937272677;f1=3896.0952380952385;f2=189.52380952380943;f3=169.3809523809524;pp1=1.0;pp2=0.0;pp3=0.0;QC=21;EN=4255.0]':2.0647804767273055));"""

# 应用正则表达式来清理注释
cleaned_tree = re.sub(r"'\[(.*?)\]'", clean_annotation, tree_data)

print(cleaned_tree)
